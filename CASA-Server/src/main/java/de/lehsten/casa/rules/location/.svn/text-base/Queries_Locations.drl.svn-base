#created on: 19.09.2012
package de.lehsten.casa.rules.location

import java.lang.Math;
import de.lehsten.casa.contextserver.types.entities.place.Stop;
import de.lehsten.casa.contextserver.types.entities.services.websites.LocationWebsite;


query "GetClosestStop" (Double Lat, Double Lon)
	r : Stop($x1:latitude, $y1:longitude)
	not Stop($x2:latitude, $y2:longitude, eval(Math.sqrt((($x2-Lat)*($x2-Lat))+(($y2-Lon)*($y2-Lon))) < Math.sqrt((($x1-Lat)*($x1-Lat))+(($y1-Lon)*($y1-Lon)))))
end

//DEBUG:
query "GetClosestStopWebsite" (Double Lat, Double Lon)
	s : Stop($x1:latitude, $y1:longitude)
	not Stop($x2:latitude, $y2:longitude, eval(Math.sqrt((($x2-Lat)*($x2-Lat))+(($y2-Lon)*($y2-Lon))) < Math.sqrt((($x1-Lat)*($x1-Lat))+(($y1-Lon)*($y1-Lon)))))
	r : LocationWebsite (properties["stopNumber"] == s.stopNumber)
end

query "GetCloseStopWebsites" (Double Lat, Double Lon, Double Dist)
	s : Stop( eval((latitude <= (Lat + (Dist*0.009))) && (latitude >= (Lat - (Dist*0.009)))) && (longitude <= (Lon + (Dist*0.015))) && (longitude >= (Lon - (Dist*0.015))) )
	r : LocationWebsite (properties["stopNumber"] == s.stopNumber)
end	